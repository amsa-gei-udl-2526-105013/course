---
title: "Administrant RAIDs"
lang: ca
---

## InstalÂ·laciÃ³ d'un RAID1 a Alma Linux

### ðŸ§° Requisits previs

- Dos discs durs virtuals de 20 GB cadascun per la configuraciÃ³ del RAID1.
- Imatge iso basada en Alma Linux.
- Un software de virtualitzaciÃ³ com VirtualBox, VMware, UTM o QEMU.

### ðŸŽ¯ Objectiu
Configurar un **RAID1** per la particiÃ³ `root (/)` durant la instalÂ·laciÃ³ dâ€™Alma Linux.

### ðŸª› Procediment dâ€™instalÂ·laciÃ³

1. Inicieu la instalÂ·laciÃ³ dâ€™Alma Linux fins a la pantalla de **selecciÃ³ de discs**.  
2. Seleccioneu **els dos discs virtuals** i trieu lâ€™opciÃ³ **Personalitzat**.  
3. Feu clic a **Fet**.

    ![](../../figs/slides/03-raids/install_alma_raid1/seleccio_discs.png)

4. ApareixerÃ  la finestra de **particions manuals**:

    ![](../../figs/slides/03-raids/install_alma_raid1/particions_manuals.png)

5. Les particions creades seran:

   - `/boot/efi` â€“ 600 MB  
   - `/boot` â€“ 1 GB  
   - `swap` â€“ 2 GB  
   - `/` â€“ 16,4 GB  

6. Per configurar el RAID1, seleccioneu la particiÃ³ `/` i feu clic a **Editar**.

    ![](../../figs/slides/03-raids/install_alma_raid1/raid1.png)

    - Trieu **RAID1** com a tipus de dispositiu.  
    - Feu clic a **Fet** â†’ **Acceptar canvis**.

### âœ… Resultat final

![](../../figs/slides/03-raids/install_alma_raid1/resultat.png)

- Un cop finalitzada la instalÂ·laciÃ³, el sistema es reiniciarÃ .  
- Si tot Ã©s correcte, Alma Linux arrencarÃ  sense problemes.  
- Observeu que tenim dues particions `/` (una per disc).  

:::{.callout-warning title="QuÃ¨ passa si el disc vda falla?"}
En cas de fallada del disc `vda`, el sistema **no arrencarÃ ** perquÃ¨ la particiÃ³ `/boot` no estÃ  replicada en RAID. Tenim replicada nomÃ©s la particiÃ³ `/`. Per tant, si el disc `vda` falla, el sistema no podrÃ  accedir a la particiÃ³ `/boot` i no podrÃ  arrencar.
:::

## MigraciÃ³ de la carpeta `/home` a un RAID5

### ðŸ§° Requisits
En la mÃ quina virtual anterior, podem afegir quatre discs durs virtuals de 1 GB cadascun (vdc, vdd, vde, vdf).

### ðŸŽ¯ Objectiu
Migrar el contingut de la carpeta `/home` a un dispositiu **RAID5** format per quatre discs virtuals.

### ðŸª› Procediment

1. Creem el RAID5 amb la comanda segÃ¼ent:

    ```bash
    mdadm --create --verbose /dev/md0 --level=5 --raid-devices=4 /dev/vd[c-f]
    ```

2. Comprovem que el RAID s'ha creat correctament amb la comanda:

    ```bash
    cat /proc/mdstat
    ```

3. Creem un sistema de fitxers XFS en el dispositiu RAID5:

    ```bash
    mkfs.xfs /dev/md0
    ```

4. Muntarem el dispositiu RAID5 en un directori temporal:

    ```bash
    mkdir /mnt/raid
    mount /dev/md0 /mnt/raid
    ```

5. Copiem el contingut de la carpeta `/home` al dispositiu RAID5:

    ```bash
    cp -r /home/* /mnt/raid
    ```

6. Desmuntem el dispositiu RAID5 del directori temporal:

    ```bash
    umount /mnt/raid
    ```

7. Muntarem el dispositiu RAID5 en la carpeta `/home`:

    ```bash
    mount /dev/md0 /home
    ```

8. Obtenim el UUID del dispositiu RAID5 amb la comanda:

    ```bash
    blkid /dev/md0
    ```
9. Fem una cÃ²pia de seguretat del fitxer `/etc/fstab`:

    ```bash
8. Per fer que el muntatge sigui permanent, afegim la segÃ¼ent lÃ­nia al fitxer `/etc/fstab`:

    ```bash
    UUID=<UUID>  /home  xfs  defaults  0 0
    ```

### âœ… Resultat final

- El contingut de la carpeta `/home` s'ha migrat correctament al dispositiu RAID5.  
- El sistema utilitza ara el RAID5 per emmagatzemar les dades dels usuaris

## SimulaciÃ³ de fallades en el RAID5

Ara simularem una fallada en un dels discs durs virtuals del RAID5. I observarem com el sistema continua funcionant sense problemes.

1. Crearem un usuari de prova i un fitxer de text a la seva carpeta `/home`:

    ```bash
    useradd test
    echo "Hola mÃ³n" > /home/test/hola.txt
    chown -R test:test /home/test
    ```

2. Simulem la fallada d'un disc dur virtual del RAID5:

    ```bash
    mdadm --manage /dev/md127 --fail /dev/vdc
    ```

3. Comprovem que podem accedir al fitxer de text creat anteriorment:

    ```bash
    cat /home/test/hola.txt
    ```

4. Ara intentarem simular la fallada d'un segon disc dur virtual del RAID5:

    ```bash
    mdadm --manage /dev/md127 --fail /dev/vdd
    ```

5. Comprovem que el sistema ens avisa que no es pot fallar un segon disc perquÃ¨ el RAID5 nomÃ©s tolera la fallada d'un disc:

    ```bash
    mdadm: Cannot remove /dev/vdd from /dev/md0,
           array will be failed.
    ```

## Exercicis

Es demana instalÂ·lar un sistema AlmaLinux de forma tradicional sense RAID en un disc virtual de 20â€¯GB (vda), creant les quatre particions habituals: `/boot/efi`, `/boot`, `swap` i `/`.

Un cop finalitzada la instalÂ·laciÃ³:

- Afegiu dos discs durs virtuals addicionals de 20â€¯GB cadascun (**vdb i vdc**).
- Migrar les particions existents a RAID1 de la segÃ¼ent manera:
  - `/boot/efi` â†’ RAID1 amb **vdb1** i **vdc1**.
  - `/boot` â†’ RAID1 amb **vdb2** i **vdc2**.
  - `swap` â†’ RAID1 amb **vdb3** i **vdc3**.
  - `/` â†’ RAID1 amb **vdb4** i **vdc4**.
- Configureu el sistema perquÃ¨ arranqui correctament des dels discs vdb i vdc.
- Un cop comprovat el correcte funcionament, elimineu el disc original vda.
- Verificar que el sistema arranca correctament desprÃ©s de la migraciÃ³.
- Confirmar que totes les particions es troben en RAID1.
- Documentar tot el procÃ©s amb captures de pantalla, explicacions detallades i justificacions tÃ¨cniques en un informe final.